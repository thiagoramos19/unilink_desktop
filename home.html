<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniLink - Login</title>
    <link rel="stylesheet" href="home_style.css">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&amp;display=swap" rel="stylesheet">
    <!-- ESTILOS ADICIONAIS PARA O SCROLL APENAS NO FEED E AJUSTE DE POSTAGEM -->
    <style>
        /* Fix para remover o scroll global e colocar apenas no feed */
        body {
            overflow: hidden;
            height: 100vh; /* Garante que o body ocupe a altura total do viewport */
        }
        .organizador {
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        .principal {
            /* Permite que o conte√∫do principal use o espa√ßo restante */
            flex-grow: 1; 
            overflow-y: hidden; /* Remove scroll do principal */
            display: flex;
        }
        #timeline-container {
            /* ATIVA O SCROLL APENAS AQUI */
            flex-grow: 1;
            overflow-y: auto;
        }

        /* Estilo para a imagem rec√©m-adicionada no post */
        .post-imagem {
            max-width: 100%; 
            height: auto;
            border-radius: 4px;
            margin-top: 10px;
        }
        
        /* ESTILO PARA A PR√âVIA DA IMAGEM ANEXADA (EXPANDE O MENU DE POSTAGEM) */
        #preview-imagem {
            max-width: 100%;
            max-height: 200px; 
            margin-top: 10px;
            border-radius: 8px;
            object-fit: contain; 
            display: none; /* Inicia escondido, o JS controla a visibilidade */
            border: 1px solid #ddd; /* D√° um destaque visual */
            padding: 5px;
        }
        
    </style>
</head>
<body>
    <div class="menu_home">
        <div class="menu_real">
            <a href="home.html" style="background-color: #60754c;"><img src="img/home.png" alt="home" class="icon"></a>
            <a href="usuarios.html"><img src="img/pesquisar.png" alt="usuarios" class="icon"></a>
            <a href="jogaprarolo.html"><img src="img/jogaprolo.png" alt="jogaprarolo" class="icon"></a>
            <a href="eventos.html"><img src="img/agenda.png" alt="eventos" class="icon"></a>
            <a href="dm.html"><img src="img/dm_icon.png" alt="dm" class="icon"></a>
        </div>
        <div class="menu_conta">
            <a href="login.html"><img src="img/sair.png" alt="home" class="icon"></a>
            <a href="seuperfil.html"><img src="img/seuperfil.png" alt="home" class="icon"></a>
        </div>
    </div>
    <div class="organizador"> 
        <header>
            <p id="unilink">unilink</p>
        </header>
        <div class="principal">
            <div class="publicar_box">
                <div class="publicar_post">
                    <!-- ID para JS -->
                    <textarea type="text" placeholder="O que est√° acontecendo?" class="post" id="post-textarea"></textarea>
                    <div class="atributos">
                        <!-- BOT√ÉO DE ANEXAR FOTO COM ID PARA O JS -->
                        <button type="button" class="arquivo" id="btn-anexar-foto"><img src="img/image.png" alt="Anexar Imagem"></button>
                        <button type="button" class="arquivo"><img src="img/musica.png" alt="Anexar M√∫sica"></button>
                    </div>
                    <!-- PR√âVIA DA IMAGEM (Sem styles inline, usando o #preview-imagem do CSS) -->
                    <img id="preview-imagem" src="" alt="Pr√©via da Imagem Anexada">
                    <!-- INPUT FILE ESCONDIDO (Chave para o anexo) -->
                    <input type="file" id="input-file-foto" accept="image/*" style="display: none;">
                    <!-- BOT√ÉO POSTAR COM ID PARA o JS -->
                    <button class="postar_botao" id="btn-postar">Postar</button>
                </div>
            </div>

            <!-- CONTAINER PRINCIPAL DA TIMELINE AGORA TEM ID E SCROLL ATIVO -->
            <div class="timeline" id="timeline-container">
                <div class="stories">
                    <div class="seu_story">
                        <img src="img/maria.png" alt="">
                        <button onclick="abrirCamera()">+</button>
                    </div>
                    <button class="ciclano_story"><img src="img/ciclano.png" alt=""></button>
                </div>
                
                <!-- CONTAINER DA C√ÇMERA (Vis√£o em tela cheia) -->
                <div id="camera-container" class="hidden">
                    <video id="video-stream" autoplay playsinline></video>
                    <button id="close-btn" onclick="fecharCamera()">Voltar</button>
                </div>

                <div class="filtro_box">
                    <div class="filtro"> 
                        <p>Adicionar filtro</p> 
                        <!-- ID para JS -->
                        <button id="btn-filtro-icon"><img src="img/filtro_icon.png" alt=""></button>
                    </div>
                </div>
                <!-- NOVOS POSTS SER√ÉO INJETADOS AQUI ABAIXO DO filtro_box -->
                
                <div class="post_1 filterable-post">
                    <div class="foto_e_adicionar">
                        <img src="img/ciclano.png" alt="" class="foto_perfil">
                        <!-- ADICIONEI CLASSE PARA O JS -->
                        <button class="btn-adicionar-amigo"><img src="img/adicionaramigo.png" alt="Adicionar Amigo" class="adicionaramigo"></button>
                    </div>
                    <div class="corpo_do_post">
                        <p><b>Ciclano - CCH - Biblioteconomia</b></p>
                        <p>gente to fazendo uma pesquisa pra P1, podem responder se puderem? Muito obrigado! <a href="bit.ly/unilink_rio">bit.ly/unilink_rio</a></p>
                        <div class="curtir_box"> 
                            <!-- ADICIONEI CLASSE PARA O JS -->
                            <button class="btn-curtir"><img src="img/like.png" alt="Curtir"></button>
                            <p>123</p>
                        </div>
                    </div>
                </div>

                <div class="post_2 filterable-post">
                    <div class="foto_e_adicionar">
                        <img src="img/fulano.png" alt="" class="foto_perfil">
                        <!-- ADICIONEI CLASSE PARA O JS -->
                        <button class="btn-adicionar-amigo"><img src="img/adicionaramigo.png" alt="Adicionar Amigo" class="adicionaramigo"></button>
                    </div>
                    <div class="corpo_do_post">
                        <p><b>Fulano - CCET - Sistemas de Informa√ß√£o</b></p>
                        <iframe data-testid="embed-iframe" style="border-radius:12px" src="https://open.spotify.com/embed/track/5p48T2Tqm7xX3ym7uslGOg?utm_source=generator&theme=0" width="100%" height="152px" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
                        <div class="estrelas"> 
                            <!-- ESTRELAS ATIVAS PARA JS -->
                            <button class="estrela" data-valor="1"><img src="img/estrelaacesa.png" alt=""></button>
                            <button class="estrela" data-valor="2"><img src="img/estrelaacesa.png" alt=""></button>
                            <button class="estrela" data-valor="3"><img src="img/estrelaacesa.png" alt=""></button>
                            <button class="estrela" data-valor="4"><img src="img/estrelaacesa.png" alt=""></button>
                            <button class="estrela" data-valor="5"><img src="img/estrelaapagada.png" alt=""></button>
                        </div>
                    </div>
                </div>

                <div class="post_3 filterable-post">
                    <div class="foto_e_adicionar">
                        <img src="img/unibot.png" alt="" class="foto_perfil">
                    </div>
                    <div class="corpo_do_post">
                        <p><b>Oportunidade de Emprego</b></p>
                        <div class="emprego_box">
                            <p>Vaga de instrutor de TI</p>
                            <button><a href=""><b>Saiba mais</b></a></button>
                        </div>
                        
                        <div class="curtir_box"> 
                            <!-- ADICIONEI CLASSE PARA O JS -->
                            <button class="btn-curtir"><img src="img/like.png" alt="Curtir"></button>
                            <p>123</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="eventos">
                <div class="eventos_box">
                    <p class="proxeventos"><b>Pr√≥ximos eventos</b></p>
                    <div class="evento">
                        <img src="img/atletica_adm.png" alt="" class="foto_perfil">
                        <div class="corpodoevento">
                            <div class="emprego_box">
                                <p>Acende o farol - Atl√©tica ADM</p>
                                <p>03/12</p>
                            </div>
                            <button>123 marcaram presen√ßa</button>
                        </div>
                    </div>

                    <div class="evento">
                        <img src="img/atletica_adm.png" alt="" class="foto_perfil">
                        <div class="corpodoevento">
                            <div class="emprego_box"> 
                                <p>Acende o farol - Atl√©tica ADM</p>
                                <p>04/12</p>
                            </div>
                            <button>43 marcaram presen√ßa</button>
                        </div>
                    </div>
                </div>
            </div>
        </div> ¬† ¬† ¬† ¬† ¬† ¬†
    </div>
</body>
<script>
    const cameraContainer = document.getElementById('camera-container');
    const videoStream = document.getElementById('video-stream');
    let currentStream; 

    /**
    * Bicha, essa fun√ß√£o AQUI abre a c√¢mera!
    */
    async function abrirCamera() {
        console.log("Abrindo a c√¢mera, respira fundo...");
        
        try {
            currentStream = await navigator.mediaDevices.getUserMedia({ 
                video: { facingMode: 'user' }, 
                audio: false 
            });

            videoStream.srcObject = currentStream;
            cameraContainer.classList.remove('hidden');

        } catch (err) {
            console.error("Ai, que vexame! Erro ao acessar a c√¢mera: ", err);
            // Substitu√≠ alert() por um console.error mais suave, pois alerts s√£o ruins em iframes.
            console.error("Amada, n√£o consegui acessar sua c√¢mera! Verifique as permiss√µes, viu?");
        }
    }

    /**
    * E essa fun√ß√£o AQUI fecha e limpa a zona!
    */
    function fecharCamera() {
        console.log("Fechando a c√¢mera. Adeus, close!");

        if (currentStream) {
            currentStream.getTracks().forEach(track => {
                track.stop(); 
            });
            currentStream = null;
            videoStream.srcObject = null; 
        }

        cameraContainer.classList.add('hidden');
    }
    
    // --- 1. BOT√ÉO DE ANEXAR FOTO (Chamar o input file escondido e criar preview) ---
    const btnAnexarFoto = document.getElementById('btn-anexar-foto');
    const inputFileFoto = document.getElementById('input-file-foto');
    const previewImagem = document.getElementById('preview-imagem');

    btnAnexarFoto.addEventListener('click', () => {
        inputFileFoto.click(); // Simula o clique no input de arquivo
    });

    inputFileFoto.addEventListener('change', (event) => {
        if (event.target.files.length > 0) {
            console.log("Foto anexada com sucesso! üíÖ");
            
            // Mostrar preview (O JS mant√©m o controle de visibilidade via style.display)
            const file = event.target.files[0];
            const reader = new FileReader();
            reader.onload = function(e) {
                previewImagem.src = e.target.result;
                previewImagem.style.display = 'block';
            };
            reader.readAsDataURL(file);

        } else {
            previewImagem.src = '';
            previewImagem.style.display = 'none';
        }
    });
    
    // --- 2. AVALIA√á√ÉO COM ESTRELAS (Acender/apagar as estrelas) ---
    const estrelas = document.querySelectorAll('.estrelas .estrela');
    const estrelaAcesa = 'img/estrelaacesa.png';
    const estrelaApagada = 'img/estrelaapagada.png';

    estrelas.forEach(estrela => {
        estrela.addEventListener('click', () => {
            const valor = parseInt(estrela.getAttribute('data-valor'));
            
            estrelas.forEach((e, index) => {
                // Acende a estrela se o √≠ndice for menor que o valor clicado
                if (index < valor) {
                    e.querySelector('img').src = estrelaAcesa;
                } else {
                    e.querySelector('img').src = estrelaApagada;
                }
            });
            console.log(`Avalia√ß√£o de ${valor} estrelas! ‚ú®`);
        });
    });

    // --- 3. CRIAR POST (Fun√ß√£o de postar e injetar no DOM) ---
    const btnPostar = document.getElementById('btn-postar');
    const textAreaPost = document.getElementById('post-textarea');
    const timelineContainer = document.getElementById('timeline-container');

    btnPostar.addEventListener('click', () => {
        const conteudo = textAreaPost.value.trim();
        const arquivo = inputFileFoto.files[0];
        let imagemUrl = null;

        if (!conteudo && !arquivo) {
            console.error("Amada, escreve alguma coisa ou anexa uma foto, por favor! üôè");
            return;
        }
        
        // Gerar URL da imagem (se houver) para o novo post
        if (arquivo) {
            imagemUrl = URL.createObjectURL(arquivo);
        }

        // Simula√ß√£o do ID e nome do usu√°rio logado para o novo post
        const userNome = "Voc√™ - Maria";
        const userFoto = "img/maria.png"; // Usando a foto do menu_conta

        // Estrutura HTML do novo post, usando o formato do post_1. Adicionando 'filterable-post'
        const newPostHTML = `
            <div class="post_1 filterable-post">
                <div class="foto_e_adicionar">
                    <img src="${userFoto}" alt="Foto de Perfil" class="foto_perfil">
                    <!-- Usu√°rio logado n√£o tem bot√£o 'Adicionar Amigo' -->
                </div>
                <div class="corpo_do_post">
                    <p><b>${userNome}</b></p>
                    <p>${conteudo.replace(/\n/g, '<br>')}</p>
                    ${imagemUrl ? `<img src="${imagemUrl}" alt="Conte√∫do do Post" class="post-imagem">` : ''}
                    <div class="curtir_box"> 
                        <button class="btn-curtir"><img src="img/like.png" alt="Curtir"></button>
                        <p>0</p>
                    </div>
                </div>
            </div>
        `;

        // Injetar o novo post no topo da timeline (ap√≥s o filtro_box)
        const filtroBox = document.querySelector('.filtro_box');
        filtroBox.insertAdjacentHTML('afterend', newPostHTML);

        alert("Post enviado com sucesso!");

        // Limpar os campos
        textAreaPost.value = '';
        inputFileFoto.value = null; 
        previewImagem.src = '';
        previewImagem.style.display = 'none';

        // Reaplicar listeners de curtir para o novo post!
        aplicarListenersDePostagem();
    });

    // --- 4. FILTRO (Fun√ß√£o que agora esconde e mostra posts de verdade) ---
    const btnFiltroIcon = document.getElementById('btn-filtro-icon');
    
    btnFiltroIcon.addEventListener('click', () => {
        // Encontra o container do filtro e troca a classe 'ativo'
        const filtroDiv = btnFiltroIcon.closest('.filtro');
        filtroDiv.classList.toggle('ativo');
        
        // Verifica se a classe 'ativo' est√° presente ap√≥s o toggle
        const isActived = filtroDiv.classList.contains('ativo');
        
        // Seleciona TODOS os posts filtr√°veis (incluindo os rec√©m-criados)
        const allPosts = document.querySelectorAll('#timeline-container .filterable-post');

        allPosts.forEach(post => {
            // Se o filtro estiver ATIVADO
            if (isActived) {
                // Se for o post de emprego (.post_3), mostra
                if (post.classList.contains('post_3')) {
                    post.style.display = 'flex'; // Usando 'flex' assumindo o layout original
                } else {
                    // Se n√£o for o post de emprego, esconde
                    post.style.display = 'none';
                }
            } else {
                // Se o filtro estiver DESATIVADO, mostra todos
                post.style.display = 'flex';
            }
        });

        if (isActived) {
            console.log("Filtro ATIVADO! Mostrando apenas posts de emprego. üîé");
        } else {
            console.log("Filtro DESATIVADO! Mostrando todos os posts. üåç");
        }
    });

    // --- FUN√á√ïES DE INTERA√á√ÉO (Aplicadas na inicializa√ß√£o e em novos posts) ---
    function aplicarListenersDePostagem() {
        
        // 5. CURTIR BUTTONS
        // Seleciona todos os bot√µes de curtir existentes e novos
        const btnCurtir = document.querySelectorAll('.curtir_box .btn-curtir');
        
        btnCurtir.forEach(button => {
            // Verifica se o listener j√° foi adicionado
            if (!button.dataset.listenerAdded) {
                button.addEventListener('click', () => {
                    const curtirBox = button.closest('.curtir_box');
                    const countElement = curtirBox.querySelector('p');
                    let count = parseInt(countElement.textContent) || 0;

                    if (button.classList.contains('liked')) {
                        // Descurtir
                        count--;
                        button.classList.remove('liked');
                        console.log("Post descurtido! üíî");
                    } else {
                        // Curtir
                        count++;
                        button.classList.add('liked');
                        console.log("Post curtido! ‚ù§Ô∏è");
                    }
                    countElement.textContent = count;
                });
                button.dataset.listenerAdded = 'true'; // Marca que o listener foi adicionado
            }
        });

        // 6. ADICIONAR AMIGO BUTTONS
        const btnAdicionarAmigo = document.querySelectorAll('.btn-adicionar-amigo');

        btnAdicionarAmigo.forEach(button => {
            if (!button.dataset.listenerAdded) {
                button.addEventListener('click', () => {
                    // 1. Simular o alerta de "adicionado" no console
                    alert("Amigo adicionado com sucesso!");
                    
                    // 2. Desaparecer o bot√£o
                    button.style.display = 'none';
                });
                button.dataset.listenerAdded = 'true'; // Marca que o listener foi adicionado
            }
        });
    }

    // Aplica os listeners na inicializa√ß√£o da p√°gina
    aplicarListenersDePostagem();
</script>
</html>
